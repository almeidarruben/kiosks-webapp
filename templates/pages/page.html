{% extends "base.html" %}
{% load mezzanine_tags keyword_tags %}

{% block meta_title %}{{ page.meta_title }}{% endblock %}

{% block meta_keywords %}{% metablock %}
{% keywords_for page as keywords %}
{% for keyword in keywords %}
    {% if not forloop.first %}, {% endif %}
    {{ keyword }}
{% endfor %}
{% endmetablock %}{% endblock %}

{% block meta_description %}{% metablock %}
{{ page.description }}
{% endmetablock %}{% endblock %}

{% block title %}
{% editable page.title %}{{ page.title }}{% endeditable %}
{% endblock %}

{% block main %}

<script type="text/javascript">

function goto(pagina_pk, div_id) {
	var formatedSlug = div_id.replace("/", "-");
    $("#goto_div").attr("id", formatedSlug);
    var divID = document.getElementById(formatedSlug);
	var url = "/get/pagina/"+pagina_pk;
	var returnDivID = "iifa-nav"

    $.get(url, function(data) {
		if (data.class == "page") {
			divID.innerHTML = "<div class='page-back-button' onclick=\"gotoBack('" + returnDivID + "');\"></div><div class='page-container'><div class='page-text-wrapper-TTFBI'><h1>" + data.pagina.title + "</h1><div class='page-text-TTFBI'><p>" + data.pagina.description + "</p></div><div class='page-text-footer-TTFBI'><p>" + data.pagina.rodape + "</p></div><div class='page-text-buttons-TTFBI'><div class='button button-submit' style='width: 110px;'><a href=''>Centros Associados</a></div></div></div></div>";

			// FIXME: paragrafs in data.pagina.description & data.pagina.rodape
        
		} else if (data.class == "submenus") {
			var str = "<nav id='" + data.pagina.slug + "-nav' class='page-subnav'>";
			var menuLinks = "";
			
			$.each(data.botoes, function(index, element) {
				menuLinks += "<a href='#' onClick=\"goto('" + element.link_para + ",'" + element.slug + "')\"><h1>" + element.titulo + "</h1><h2>" + element.descricao + "</h2></a>";
			});
			
			str += menuLinks;

			str += "</nav>";
			divID.innerHTML = str;
			setNavCss(data.pagina.slug + "-nav", Object.keys(data.botoes).length);
			//setZindexOrder("#iifa/teste-sub-nav a");
			// FIXME o id do objecto nao pode ter "/"" por isso é que tinhamos de fazer getElementById
			// FIXME: tive a testar na consola alterando o id para "iifa-teste-sub-nav" e trabalha, basta entao alterares o valor k passamos no json, pk o zindex so dá para fazer dessa maneira. Pk o getElement.... retorna um objecto e eu preciso é do "nome-do-objecto a" pk o z-index é aplicado no "a"

			// TODO jaslkjdlas
		}
        
        $(".content-container").animate({"left": -($(divID).position().left)}, 600);
    });
};

</script>

{% if page.pagina %}
	{{ page.description }}
{% elif page.submenus %}
	<nav id="{{page.submenus.slug}}-nav" class="page-subnav">
		{% for botao in page.submenus.botoes.all %}
			<a href="#" onClick="goto({{ botao.link_para.pk }}, '{{ botao.link_para.slug }}')">
	        	<h1>{{ botao }}</h1>
	        </a>
		{% endfor %}
	</nav>
	
    <div id="goto_div" class="page">

	</div>
{% endif %}
<script>
	setNavCss("{{page.submenus.slug}}-nav","{{page.submenus.botoes.count }}");
	setZindexOrder("#{{page.submenus.slug}}-nav a");	
</script>
{% endblock %}

