{% extends "base.html" %}
{% load mezzanine_tags keyword_tags %}

{% block meta_title %}{{ page.meta_title }}{% endblock %}

{% block meta_keywords %}{% metablock %}
{% keywords_for page as keywords %}
{% for keyword in keywords %}
    {% if not forloop.first %}, {% endif %}
    {{ keyword }}
{% endfor %}
{% endmetablock %}{% endblock %}

{% block meta_description %}{% metablock %}
{{ page.description }}
{% endmetablock %}{% endblock %}

{% block title %}
{% editable page.title %}{{ page.title }}{% endeditable %}
{% endblock %}

{% block main %}

<script type="text/javascript">

function goto(pagina_pk, div_id, parent) {
	var formatedSlug = div_id.replace("/", "-");
    $("#goto_div").attr("id", formatedSlug);
    var divID = document.getElementById(formatedSlug);
	var url = "/get/pagina/"+pagina_pk;
	var returnDivID = parent + "-nav";
	var str = "";

    $.get(url, function(data) {
		if (data.class == "page") {
			divID.innerHTML = "<div class='page-back-button' onclick=\"gotoBack('" + returnDivID + "','"+ formatedSlug +"');\"></div><div class='page-container'><div class='page-text-wrapper-TTFBI'><h1>" + data.pagina.title + "</h1><div class='page-text-TTFBI'><p>" + data.pagina.description + "</p></div><div class='page-text-footer-TTFBI'><p>" + data.pagina.rodape + "</p></div><div class='page-text-buttons-TTFBI'><div class='button button-submit' style='width: 110px;'><a href=''>Centros Associados</a></div></div></div></div>";
			// FIXME: paragraphs in data.pagina.description & data.pagina.rodape
        
		} else if (data.class == "submenus") {
			str = "<nav id='" + data.pagina.slug + "-nav' class='page-subnav'>";
			var menuLinks = "";
			
			$.each(data.botoes, function(index, element) {
				menuLinks += "<a href='#' onClick=\"goto('" + element.link_para + ",'" + element.slug + "')\"><h1>" + element.titulo + "</h1><h2>" + element.descricao + "</h2></a>";
			});
			
			str += menuLinks;
			str += "</nav>";

			divID.innerHTML = str;

			setNavCss(data.pagina.slug + "-nav", Object.keys(data.botoes).length);
			setZindexOrder("#" + data.pagina.slug + "-nav a");
		} else if (data.class == "contact") {
			divID.innerHTML = "<div id=" + data.pagina.slug + " class='page'><div class='page-back-button' onclick=\"gotoBack('" + returnDivID + "','"+ formatedSlug +"');\"></div><div class='page-container'><div class='page-text-wrapper-C'><h1>" + data.pagina.title + "</h1><div class='page-text-C'><p>" + data.pagina.endereco + "</p><br><p>Email: " + data.pagina.email + "</p><p>Telefone: " + data.pagina.telefone + "</p><p>Fax: " + data.pagina.fax + "</p><p>Web: " + data.pagina.website + "</p></div></div><img class='page-contact-img' src='#'></div></div>";
            
		} else if (data.class == "list") {

			if (data.pagina.tipo == "prot_pub") {
				protocolUrl = "/get/items/"+pagina_pk;
				$.get(protocolUrl, function(protocol_data) {
					str = "<div class='protocol-wrapper'><div class='protocol-content'>";
					$.each(protocol_data, function(protocol, element) {
						str += "<div class='protocol-topic'><h1>" + element.titulo + "</h1><p>" + element.objectivos + "</p><div class='protocol-subtitle'><h2>Assinatura:</h2><p>" + element.assinatura + "</p><h2>Termo:</h2><p>" + element.termo + "</p></div><div class='protocol-subtitle'><h2>Unidade:</h2><p>" + element.unidade + "</p></div></div>"
					});
					str += "</div></div>"
					divID.innerHTML = str;
				});
			} else {
				str = "<div class='list-wrapper'><h1>" + data.pagina.title + "</h1><div class='list-container'>";

				var catUrl = "/get/items/"+pagina_pk;
				$.get(catUrl, function(list_data) {
					$.each(list_data, function(category, element) {
						str += "<div class='list-item-category'><h1>" + category + "</h1>";
						$.each(element, function(index, e) {
							str += "<div class='list-item'><h2>" + e.titulo +"</h2><div class='list-item-parag-wrapper'><p class='list-item-parag-bold'>Candidatura:</p><p>"+ e.candidatura +"</p></div>";

		                    str += "<div class='list-item-parag-wrapper'><p class='list-item-parag-bold'>Fonte de Financiamento:</p><p>" + e.financiamento + "</p></div>";

		                    str += "<div class='list-item-parag-wrapper'><p class='list-item-parag-bold'>Unidade:</p><p>" + e.unidade + "</p></div>";

		                    str += "<div class='list-item-parag-wrapper'><p class='list-item-parag-bold'>Respons√°vel:</p><p>" + e.responsavel + "</p></div></div>";
	                	});
					});
					str += "</div></div>";
					divID.innerHTML = str;
				});
			}
		}

        $(".content-container").animate({"left": -($(divID).position().left)}, 600);
    });
};

</script>

{% if page.pagina %}
{% elif page.submenus %}
	<nav id="{{page.submenus.slug}}-nav" class="page-subnav">
		{% for botao in page.submenus.botoes.all %}
			<a href="#" onClick="goto({{ botao.link_para.pk }}, '{{ botao.link_para.slug }}', '{{ page.submenus.slug }}')">
	        	<h1>{{ botao }}</h1>
	        </a>
		{% endfor %}
	</nav>
	
    <div id="goto_div" class="page">

	</div>
{% endif %}
<script>
	setNavCss("{{page.submenus.slug}}-nav","{{page.submenus.botoes.count }}");
	setZindexOrder("#{{page.submenus.slug}}-nav a");	
</script>
{% endblock %}

